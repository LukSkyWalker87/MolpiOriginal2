<!-- ====== GRILLA: look & feel Productos ====== -->
<style>
.promociones-component .card { box-shadow: 0 2px 4px rgba(0,0,0,.08); border: 0; }
.promociones-component .card-header { background:#fff; border-bottom:1px solid #e9ecef; padding:.75rem 1rem; }
.promociones-component .toolbar .form-control { height:36px; font-size:.875rem; }
.promociones-component .btn { border-radius:.375rem; }
.promociones-component .btn-sm { padding:.3rem .55rem; font-size:.8rem; }
.promociones-component .table { margin:0; font-size:.85rem; }
.promociones-component .table thead th{
  background:#f8f9fa; border-bottom:2px solid #dee2e6; color:#495057;
  font-weight:600; font-size:.75rem; padding:.45rem .6rem; white-space:nowrap;
}
.promociones-component .table td{
  padding:.45rem .6rem; vertical-align:middle; border-top:1px solid #eef1f4; white-space:nowrap;
}
.promociones-component .table tbody tr:hover { background:#f7f9fb; }
.promociones-component .thumb {
  width:76px; height:46px; object-fit:cover; border-radius:6px; border:1px solid #e9ecef;
}
.promociones-component .badge { font-weight:600; font-size:.67rem; padding:.35em .5em; }
.promociones-component .badge-soft { background:#eef2f7; color:#5b6b7a; border:1px solid #e2e7ee; }
.promociones-component .badge-img { background:#e6f4ea; color:#207245; border:1px solid #cfead7; }
.promociones-component .badge-pdf { background:#e8f1fb; color:#1f5faa; border:1px solid #d6e6fa; }
.promociones-component .estado-activo { background:#28a745; }
.promociones-component .estado-inactivo { background:#dc3545; }
.promociones-component .acciones .btn { min-width:82px; }
.promociones-component .acciones .btn i{ margin-right:.25rem; }

/* Modal moderno */
.promociones-component .modal-content{ border:none; border-radius:12px; box-shadow:0 20px 60px rgba(0,0,0,.12); }
.promociones-component .modal-header{
  background:linear-gradient(135deg,#667eea 0%,#764ba2 100%); color:#fff; border:0; border-radius:12px 12px 0 0;
}
.promociones-component .modal-title{ font-weight:600; font-size:1.1rem; }
.promociones-component .modal-body{ background:#fafafa; }
.promociones-component .form-group label{ font-weight:600; color:#4a5568; font-size:.9rem; }
.promociones-component .form-control{ border:2px solid #e2e8f0; border-radius:8px; }
.promociones-component .form-control:focus{ border-color:#667eea; box-shadow:0 0 0 3px rgba(102,126,234,.12); }

/* Preview dentro del modal - espec√≠fico y con !important para evitar que sea pisado */
#promocionModal #imagenPreview{
  max-width: 100% !important;
  max-height: 220px !important;
  overflow: hidden !important;
}

#promocionModal .preview-img{
  display: block !important;
  max-width: 100% !important;
  max-height: 120px !important;   /* altura controlada */
  width: auto !important;
  height: auto !important;
  object-fit: contain !important;
  border: 2px solid #e2e8f0 !important;
  border-radius: 8px !important;
}

/* Toasts */
.toast-container { position: fixed; top: 20px; right: 20px; z-index: 9999; }
.custom-toast { min-width: 300px; margin-bottom: 10px; border-left: 4px solid; box-shadow: 0 4px 12px rgba(0,0,0,0.15); }
.custom-toast.success { border-left-color: #28a745; background-color: #d4edda; }
.custom-toast.error { border-left-color: #dc3545; background-color: #f8d7da; }
.custom-toast.info { border-left-color: #17a2b8; background-color: #d1ecf1; }
.custom-toast .toast-header { background:transparent; border-bottom: 1px solid rgba(0,0,0,0.1); }
.custom-toast .toast-body { color: #495057; line-height: 1.4; }
.custom-toast .close { color: inherit; opacity: .8; }
.custom-toast .close:hover { opacity: 1; }
</style>

<!-- OVERRIDES ‚Äì mismo estilo que productos -->
<style>
/* Card con buen padding */
.promociones-component .card-body{ padding:1rem !important; }

/* Toolbar espacioso */
.promociones-component .toolbar .form-control{ height:46px; font-size:1.05rem; }
.promociones-component .btn-sm{ padding:.5rem .85rem; font-size:.95rem; }

/* Tabla con buen espaciado como productos */
.promociones-component .table{ 
  margin:0; 
  font-size:1.08rem;
}

.promociones-component .table thead th{
  background:#f8f9fa; 
  border-bottom:2px solid #dee2e6; 
  color:#495057;
  font-weight:600; 
  font-size:1.05rem; 
  padding:.85rem 1rem; 
  white-space:nowrap;
}

.promociones-component .table td{
  padding:.85rem 1rem; 
  vertical-align:middle; 
  border-top:1px solid #eef1f4; 
  white-space:nowrap;
}

/* Hover agradable */
.promociones-component .table tbody tr:hover{ background:#f3f6fb; }

/* Miniaturas igual que productos */
.promociones-component .thumb{
  width:150px;
  height:90px;
  border-radius:6px;
}

/* Badges con buen tama√±o */
.promociones-component .badge{
  font-size:.8rem;
  padding:.45em .65em;
  display: inline-block;
  margin-right: 4px;
}

/* Botones con buen espacio */
.promociones-component .acciones .btn{
  min-width:108px;
  padding:.5rem .8rem;
  font-size:.95rem;
  margin-right: 3px;
}

/* En pantallas grandes, un poco m√°s */
@media (min-width:1200px){
  .promociones-component .table{ font-size:1.12rem; }
  .promociones-component .table thead th{ font-size:1.1rem; }
  .promociones-component .thumb{ width:164px; height:98px; }
}

/* Rayado suave manteniendo hover agradable */
.promociones-component .table-striped tbody tr:nth-of-type(odd){ background-color: rgba(0,0,0,.035); }
</style>

<div class="promociones-component">
  <div class="card">
    <div class="card-header d-flex justify-content-between align-items-center">
      <h6 class="mb-0"><i class="fa fa-bullhorn mr-2"></i>Gesti√≥n de Promociones</h6>
      <div class="toolbar d-flex align-items-center">
        <input id="buscarPromocion" class="form-control mr-2" placeholder="Buscar promociones...">
        <button id="btnNuevaPromocion" class="btn btn-primary btn-sm" data-toggle="modal" data-target="#promocionModal">
          <i class="fa fa-plus"></i> Nuevo
        </button>
      </div>
    </div>

    <div class="card-body p-2">
      <div class="table-responsive">
        <table class="table">
          <thead>
            <tr>
              <th>Imagen</th>
              <th>T√≠tulo</th>
              <th>Archivos</th>
              <th>Estado</th>
              <th>Fecha</th>
              <th>Acciones</th>
            </tr>
          </thead>
          <tbody id="promocionesTableBody">
            <!-- filas din√°micas -->
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>

<!-- Modal Agregar/Editar -->
<div class="modal fade" id="promocionModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <form class="modal-content" id="promocionForm">
      <div class="modal-header">
        <h5 class="modal-title" id="promocionModalLabel"><i class="fa fa-bullhorn mr-2"></i>Agregar Nueva Promoci√≥n</h5>
        <button type="button" class="close text-white" data-dismiss="modal"><span>&times;</span></button>
      </div>

      <div class="modal-body">
        <input type="hidden" id="promocionId" name="id">

        <div class="form-group">
          <label for="promocionTitulo">T√≠tulo</label>
          <input type="text" id="promocionTitulo" name="titulo" class="form-control" placeholder="Ej: Promo Agosto -25% OFF" required>
        </div>

        <div class="form-row">
          <div class="form-group col-md-6">
            <label>Imagen (opcional)</label>
            <input type="file" class="form-control-file mb-2" id="promocionImagenFile" name="imagen_file" accept="image/*">
            <small class="text-muted">Recomendado 1200√ó400px (opcional)</small>
            <div id="archivoEstadoImagen" class="mt-2 d-none"><span class="badge badge-img">IMG seleccionada</span></div>
            <div id="imagenPreview" class="mt-3 d-none">
              <img id="imagenPreviewImg" class="preview-img img-fluid" alt="Vista previa">
            </div>
          </div>

          <div class="form-group col-md-6">
            <label>Cartilla PDF (opcional)</label>
            <input type="file" class="form-control-file mb-2" id="promocionPdfFile" name="pdf_file" accept=".pdf">
            <div id="archivoEstadoPdf" class="mt-2 d-none"><span class="badge badge-pdf">PDF seleccionado</span></div>
            <div id="pdfPreview" class="mt-3 d-none">
              <div class="alert alert-info py-2 px-3 mb-0">
                <i class="fa fa-file-pdf-o"></i> <span id="pdfFileName"></span>
                <a id="pdfPreviewLink" href="#" target="_blank" class="btn btn-sm btn-outline-info ml-2"><i class="fa fa-eye"></i> Ver</a>
              </div>
            </div>
          </div>
        </div>

        <div class="form-group mb-0">
          <div class="custom-control custom-switch">
            <input type="checkbox" class="custom-control-input" id="promocionActivo" name="activo" checked>
            <label class="custom-control-label" for="promocionActivo">Promoci√≥n activa (visible en el sitio)</label>
          </div>
        </div>
      </div>

      <div class="modal-footer">
        <button class="btn btn-secondary" type="button" data-dismiss="modal"><i class="fa fa-times mr-1"></i>Cancelar</button>
        <button class="btn btn-primary" id="guardarPromocionBtn" type="submit"><i class="fa fa-save mr-1"></i>Guardar</button>
      </div>
    </form>
  </div>
</div>

<!-- Modal Confirmaci√≥n Eliminar -->
<div class="modal fade" id="deleteConfirmModal" tabindex="-1" role="dialog" aria-labelledby="deleteConfirmModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered" role="document">
    <div class="modal-content">
      <div class="modal-header bg-danger text-white">
        <h5 class="modal-title" id="deleteConfirmModalLabel"><i class="fa fa-exclamation-triangle mr-2"></i>Confirmar eliminaci√≥n</h5>
        <button type="button" class="close text-white" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
      </div>
      <div class="modal-body">
        <div class="text-center">
          <div class="mb-3"><i class="fa fa-trash-o" style="font-size:48px;color:#dc3545;"></i></div>
          <h5 class="mb-3">¬øEst√°s seguro de eliminar esta promoci√≥n?</h5>
          <p class="text-muted mb-0">Esta acci√≥n no se puede deshacer.</p>
        </div>
      </div>
      <div class="modal-footer justify-content-center">
        <button type="button" class="btn btn-secondary" data-dismiss="modal"><i class="fa fa-times mr-1"></i>Cancelar</button>
        <button type="button" class="btn btn-danger ml-2" id="confirmDeleteBtn"><i class="fa fa-trash-o mr-1"></i>S√≠, eliminar</button>
      </div>
    </div>
  </div>
</div>

<!-- Toasts -->
<div id="toastContainer" class="toast-container"></div>

<script>
// ===== TOASTS =====
window.showToast = function showToast(message, type = 'success', duration = 4000) {
  const toastContainer = document.getElementById('toastContainer');
  if (!toastContainer) {
    alert(message); // Fallback
    return;
  }
  const toastId = 'toast-' + Date.now();
  const toastHTML = `
    <div class="toast custom-toast ${type}" id="${toastId}" role="alert">
      <div class="toast-header">
        <strong class="mr-auto">${type === 'success' ? '‚úÖ √âxito' : type === 'error' ? '‚ùå Error' : 'üí° Info'}</strong>
        <button type="button" class="close" data-dismiss="toast"><span>&times;</span></button>
      </div>
      <div class="toast-body">${message}</div>
    </div>`;
  toastContainer.insertAdjacentHTML('beforeend', toastHTML);
  const toastElement = document.getElementById(toastId);
  $(toastElement).toast({ autohide: true, delay: duration });
  $(toastElement).toast('show');
  $(toastElement).on('hidden.bs.toast', function(){ toastElement.remove(); });
}

// ===== VERIFICAR AUTENTICACI√ìN =====
// ===== VERIFICAR AUTENTICACI√ìN =====
function verificarAutenticacion() {
  const token = localStorage.getItem('molpi_access_token');
  
  if (!token || token === 'null' || token === 'undefined') {
    alert('‚ö†Ô∏è Sesi√≥n expirada o no iniciada.\n\nSer√°s redirigido al login en 2 segundos...');
    setTimeout(() => window.location.href = '/admin', 2000);
    return false;
  }
  
  return true;
}
// ===== RENDER ROW (look Productos) =====
window.renderPromocionRow = function renderPromocionRow(promocion){
  console.log('üîµ Renderizando promoci√≥n:', promocion);
  
  const estado = promocion.activo
    ? '<span class="badge estado-activo">Activo</span>'
    : '<span class="badge estado-inactivo">Inactivo</span>';

  const archivos = `
    <span class="badge ${promocion.imagen ? 'badge-img' : 'badge-soft'}"><i class="fa fa-image"></i> IMG</span>
// ===== RENDER ROW (look Productos) =====
window.renderPromocionRow = function renderPromocionRow(promocion){
  const estado = promocion.activoeacion).toLocaleDateString('es-AR', { day: '2-digit', month: '2-digit', year: 'numeric' })
    : '-';

  // Imagen o placeholder
  const imagenHtml = promocion.imagen 
    ? `<img class="thumb" src="${promocion.imagen}" alt="${promocion.titulo}" onerror="this.style.display='none';">`
    : '<div class="thumb d-flex align-items-center justify-content-center bg-light text-muted"><i class="fa fa-image"></i></div>';

  const html = `
    <tr data-id="${promocion.id}">
      <td>${imagenHtml}</td>
      <td><strong>${promocion.titulo || '<em>Sin t√≠tulo</em>'}</strong></td>
      <td>${archivos}</td>
      <td>${estado}</td>
      <td>${fecha}</td>
      <td class="acciones">
        <button class="btn btn-sm btn-outline-primary btn-editar" data-id="${promocion.id}">
          <i class="fa fa-edit"></i> Editar
        </button>
        <button class="btn btn-sm btn-outline-danger btn-eliminar" data-id="${promocion.id}">
          <i class="fa fa-trash"></i> Eliminar
        </button>
      </td>
    </tr>`;
    
  console.log('‚úÖ HTML generado para promoci√≥n ID', promocion.id);
  return html;
}

// ===== CARGAR =====
window.cargarPromociones = async function cargarPromociones() {
// ===== CARGAR =====
window.cargarPromociones = async function cargarPromociones() {
  try {
    const tbody = document.getElementById('promocionesTableBody');
    if (!tbody) return;
    
    const token = localStorage.getItem('molpi_access_token');
    const response = await fetch('/promociones/admin', {
      headers: token ? { 'Authorization': `Bearer ${token}` } : {}
    });
    
    if (!response.ok) throw new Error(`HTTP ${response.status}`);
    
    const promociones = await response.json();
    
    if (promociones && promociones.length) {
      tbody.innerHTML = promociones.map(renderPromocionRow).join('');
    } else {
      tbody.innerHTML = '<tr><td colspan="6" class="text-center text-muted">No hay promociones registradas</td></tr>';
    }
  } catch (error) {
    console.error('Error cargando promociones:', error);
    const tbody = document.getElementById('promocionesTableBody');
    if (tbody) tbody.innerHTML = '<tr><td colspan="6" class="text-center text-danger">Error: ' + error.message + '</td></tr>';
  }
} console.log('üü¢üü¢üü¢ guardarPromocion() EJECUTADA!', event);
  console.log('üîµ Event type:', event?.type);
  console.log('üîµ Event target:', event?.target);
  
  if (event) {
    event.preventDefault();
    console.log('‚úÖ preventDefault llamado');
  }
  
  const btn = document.getElementById('guardarPromocionBtn');
  console.log('üîµ Bot√≥n guardar encontrado:', btn);
  
  const originalText = btn ? btn.innerHTML : '';
  
  try {
    console.log('üîµ Iniciando guardado...');
    if (btn) {
      btn.innerHTML = '<i class="fa fa-spinner fa-spin"></i> Guardando...';
// ===== GUARDAR =====
window.guardarPromocion = async function guardarPromocion(event) {
  if (event) event.preventDefault();
  
  const btn = document.getElementById('guardarPromocionBtn');
  const originalText = btn ? btn.innerHTML : '';
  
  try {
    if (btn) {
      btn.innerHTML = '<i class="fa fa-spinner fa-spin"></i> Guardando...';
      btn.disabled = true;
    }

    const token = localStorage.getItem('molpi_access_token');
    if (!token) {
      throw new Error('No hay token de autenticaci√≥n. Por favor, inicia sesi√≥n nuevamente.');
    }

    let imagenUrl = '';
    let pdfUrl = '';

    // Subir imagen si hay archivo
    const imgFile = document.getElementById('promocionImagenFile');
    if (imgFile && imgFile.files.length) {
      const fd = new FormData(); 
      fd.append('file', imgFile.files[0]);
      const up = await fetch('/upload/promocion', { 
        method: 'POST', 
        headers: { 'Authorization': `Bearer ${token}` },
        body: fd 
      });
      const res = await up.json();
      if (!up.ok) throw new Error('Error subiendo imagen: ' + (res.error || ''));
      imagenUrl = res.path;
    }

    // Subir PDF si hay archivo
    const pdfFile = document.getElementById('promocionPdfFile');
    if (pdfFile && pdfFile.files.length) {
      const fd = new FormData(); 
      fd.append('file', pdfFile.files[0]);
      const up = await fetch('/upload/promocion', { 
        method: 'POST', 
        headers: { 'Authorization': `Bearer ${token}` },
        body: fd 
      });
      const res = await up.json();
      if (!up.ok) throw new Error('Error subiendo PDF: ' + (res.error || ''));
      pdfUrl = res.path;
    }

    const promocionId = document.getElementById('promocionId').value;
    const data = {
      titulo: document.getElementById('promocionTitulo').value,
      imagen: imagenUrl || null,
      cartilla_pdf: pdfUrl || null,
      activo: document.getElementById('promocionActivo').checked ? 1 : 0
    };

    const url = promocionId ? `/promociones/${promocionId}` : '/promociones';
    const method = promocionId ? 'PUT' : 'POST';

    const response = await fetch(url, {
      method,
      headers: {
        'Content-Type': 'application/json',
        'Authorization': `Bearer ${token}`
      },
      body: JSON.stringify(data)
    });
    
    if (!response.ok) {
      const result = await response.json();
      if (response.status === 401) {
        throw new Error('Sesi√≥n expirada. Por favor, inicia sesi√≥n nuevamente.');
      }
      throw new Error(result.error || 'Error al guardar');
    }

    showToast(promocionId ? 'Promoci√≥n actualizada correctamente' : 'Promoci√≥n creada correctamente', 'success');
    $('#promocionModal').modal('hide');
    setTimeout(cargarPromociones, 300);

  } catch (e) {
    console.error('Error guardando promoci√≥n:', e); 
    showToast('Error: ' + e.message, 'error');
  } finally {
    if (btn) {
      btn.innerHTML = originalText; 
      btn.disabled = false;
    }
  }
}   const prev = document.getElementById('imagenPreview');
    const img  = document.getElementById('imagenPreviewImg');
    if (p.imagen){ img.src = p.imagen; prev.classList.remove('d-none'); }

    // preview pdf
    if (p.cartilla_pdf){
      const pdfPrev = document.getElementById('pdfPreview');
      const pdfLink = document.getElementById('pdfPreviewLink');
      const pdfName = document.getElementById('pdfFileName');
      pdfName.textContent = p.cartilla_pdf.split('/').pop();
      pdfLink.href = p.cartilla_pdf;
      pdfPrev.classList.remove('d-none');
    }

    $('#promocionModal').modal('show');
  } catch (e) {
    console.error(e); showToast('Error al cargar la promoci√≥n', 'error');
  }
}

// ===== ELIMINAR =====
window.eliminarPromocion = function eliminarPromocion(id) {
  $('#deleteConfirmModal').modal('show');
  $('#confirmDeleteBtn').off('click').on('click', async function(){
    $('#deleteConfirmModal').modal('hide');
    try{
      const token = localStorage.getItem('molpi_access_token');
      console.log('üîµ Eliminando promoci√≥n ID:', id);
      console.log('üîµ Token:', token ? `${token.substring(0, 20)}...` : 'NO HAY TOKEN');
      
      if (!token) {
        throw new Error('No hay token de autenticaci√≥n. Por favor, inicia sesi√≥n nuevamente.');
      }
      
      const r = await fetch(`/promociones/${id}`, {
        method: 'DELETE',
        headers: { 'Authorization': `Bearer ${token}` }
      });
      
      console.log('üîµ Response status:', r.status);
      
      if (!r.ok) {
        const j = await r.json();
        console.error('‚ùå Error del servidor:', j);
        
        if (r.status === 401) {
          throw new Error('Sesi√≥n expirada. Por favor, inicia sesi√≥n nuevamente.');
        }
        
        throw new Error(j.error || 'Error al eliminar');
      }
      
      const j = await r.json();
      showToast('Promoci√≥n eliminada correctamente', 'success');
      cargarPromociones();
    }catch(e){
      console.error('‚ùå Error eliminando:', e);
      showToast('Error: ' + e.message, 'error');
    }
  });
}

// ===== LIMPIAR FORM =====
window.limpiarFormulario = function limpiarFormulario() {
  document.getElementById('promocionForm').reset();
    $('#promocionModal').modal('show');
  } catch (e) {
    console.error('Error editando promoci√≥n:', e);
    showToast('Error al cargar la promoci√≥n', 'error');
  }
} document.getElementById('archivoEstadoImagen').classList.add('d-none');
// ===== ELIMINAR =====
window.eliminarPromocion = function eliminarPromocion(id) {
  $('#deleteConfirmModal').modal('show');
  $('#confirmDeleteBtn').off('click').on('click', async function(){
    $('#deleteConfirmModal').modal('hide');
    try{
      const token = localStorage.getItem('molpi_access_token');
      if (!token) {
        throw new Error('No hay token de autenticaci√≥n. Por favor, inicia sesi√≥n nuevamente.');
      }
      
      const r = await fetch(`/promociones/${id}`, {
        method: 'DELETE',
        headers: { 'Authorization': `Bearer ${token}` }
      });
      
      if (!r.ok) {
        const j = await r.json();
        if (r.status === 401) {
          throw new Error('Sesi√≥n expirada. Por favor, inicia sesi√≥n nuevamente.');
        }
        throw new Error(j.error || 'Error al eliminar');
      }
      
      showToast('Promoci√≥n eliminada correctamente', 'success');
      cargarPromociones();
    }catch(e){
      console.error('Error eliminando promoci√≥n:', e);
      showToast('Error: ' + e.message, 'error');
    }
  });
}   console.log('‚úÖ Bot√≥n nueva promoci√≥n encontrado');
    btnNueva.addEventListener('click', limpiarFormulario);
  } else {
    console.error('‚ùå Bot√≥n btnNuevaPromocion NO encontrado');
  }

  // file imagen
  const fileInput = document.getElementById('promocionImagenFile');
  fileInput?.addEventListener('change', function() {
    const file = this.files[0]; if (!file) return;
    if (!file.type.startsWith('image/')) { showToast('Seleccione una imagen v√°lida', 'error'); this.value=''; return; }
    if (file.size > 5*1024*1024)       { showToast('Imagen muy grande (m√°x. 5MB)', 'error'); this.value=''; return; }
    document.getElementById('archivoEstadoImagen').classList.remove('d-none');
    const reader = new FileReader();
    reader.onload = e => {
      const prev = document.getElementById('imagenPreview');
      const img  = document.getElementById('imagenPreviewImg');
      img.src = e.target.result; prev.classList.remove('d-none');
    };
    reader.readAsDataURL(file);
// ===== INIT =====
window.inicializarPromociones = function inicializarPromociones() {
  // Verificar autenticaci√≥n antes de hacer nada
  if (!verificarAutenticacion()) return;
  
  // Listener del formulario
  const form = document.getElementById('promocionForm');
  if (form) {
    form.removeEventListener('submit', guardarPromocion);
    form.addEventListener('submit', guardarPromocion);
  }

  // Bot√≥n nueva promoci√≥n
  const btnNueva = document.getElementById('btnNuevaPromocion');
  if (btnNueva) {
    btnNueva.addEventListener('click', limpiarFormulario);
  }     editarPromocion(id);
      } else if (target.classList.contains('btn-eliminar')) {
        console.log('üîµ Eliminando promoci√≥n ID:', id);
        eliminarPromocion(id);
      }
    });
    console.log('‚úÖ Event delegation configurado para botones de tabla');
  }

  // cargar
  cargarPromociones();
}

// Ejecutar inmediatamente cuando se carga el componente (ya que se carga v√≠a AJAX)
if (document.readyState === 'loading') {
  document.addEventListener('DOMContentLoaded', () => setTimeout(inicializarPromociones, 100));
} else {
  // DOM ya est√° listo, ejecutar inmediatamente
  setTimeout(inicializarPromociones, 100);
}

// Verificar que todas las funciones est√°n disponibles
console.log('üîµ Verificando funciones globales:');
console.log('  - window.guardarPromocion:', typeof window.guardarPromocion);
console.log('  - window.editarPromocion:', typeof window.editarPromocion);
console.log('  - window.eliminarPromocion:', typeof window.eliminarPromocion);
console.log('  - window.cargarPromociones:', typeof window.cargarPromociones);
console.log('  - window.limpiarFormulario:', typeof window.limpiarFormulario);
console.log('  - window.inicializarPromociones:', typeof window.inicializarPromociones);
console.log('‚úÖ Script de promociones completamente cargado');
</script>
  // Event delegation para botones de editar y eliminar
  const tbody = document.getElementById('promocionesTableBody');
  if (tbody) {
    tbody.addEventListener('click', function(e) {
      const target = e.target.closest('button');
      if (!target) return;

      const id = parseInt(target.getAttribute('data-id'));
      if (!id) return;

      if (target.classList.contains('btn-editar')) {
        editarPromocion(id);
      } else if (target.classList.contains('btn-eliminar')) {
        eliminarPromocion(id);
      }
    });
  }

  // Cargar promociones
  cargarPromociones();
}// Ejecutar cuando se carga el componente
if (document.readyState === 'loading') {
  document.addEventListener('DOMContentLoaded', () => setTimeout(inicializarPromociones, 100));
} else {
  setTimeout(inicializarPromociones, 100);
}
</script>