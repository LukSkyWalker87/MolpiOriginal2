<!-- ===== TESTIMONIOS – mismo look que Promociones ===== -->
<style>
/* Card / header */
.testimonios-component .card{ box-shadow:0 2px 4px rgba(0,0,0,.08); border:0; }
.testimonios-component .card-header{ background:#fff; border-bottom:1px solid #e9ecef; padding:.75rem 1rem; }
.testimonios-component .toolbar .form-control{ height:42px; font-size:.95rem; }
.testimonios-component .btn{ border-radius:.375rem; }
.testimonios-component .btn-sm{ padding:.3rem .55rem; font-size:.8rem; }

/* Tabla (idéntico a Promociones + un pelín más de aire) */
.testimonios-component .table{ margin:0; font-size:.95rem; }
.testimonios-component .table thead th{
  background:#f8f9fa; border-bottom:2px solid #dee2e6; color:#495057;
  font-weight:600; font-size:.85rem; padding:.65rem .85rem; white-space:nowrap;
}
.testimonios-component .table td{
  padding:.65rem .85rem; vertical-align:middle; border-top:1px solid #eef1f4; white-space:nowrap;
}
.testimonios-component .table tbody tr:hover{ background:#f3f6fb; }

/* Avatar / imagen */
.testimonios-component .avatar{
  width:48px; height:48px; object-fit:cover; border-radius:50%; border:1px solid #e9ecef;
}

/* Texto del testimonio truncado */
.testimonios-component .testimonio-texto{
  max-width:420px; overflow:hidden; text-overflow:ellipsis; white-space:nowrap;
}

/* Badges de estado (mismos colores) */
.testimonios-component .estado-activo{ background:#28a745; }
.testimonios-component .estado-inactivo{ background:#6c757d; }

/* Acciones como en Promociones */
.testimonios-component .acciones .btn{ min-width:82px; }
.testimonios-component .acciones .btn i{ margin-right:.25rem; }

/* Modal consistente con Promociones */
.testimonios-component .modal-content{ border:none; border-radius:12px; box-shadow:0 20px 60px rgba(0,0,0,.12); }
.testimonios-component .modal-header{
  background:linear-gradient(135deg,#667eea 0%,#764ba2 100%); color:#fff; border:0; border-radius:12px 12px 0 0;
}
.testimonios-component .modal-title{ font-weight:600; font-size:1.1rem; }
.testimonios-component .modal-body{ background:#fafafa; }
.testimonios-component .form-group label{ font-weight:600; color:#4a5568; font-size:.9rem; }
.testimonios-component .form-control{ border:2px solid #e2e8f0; border-radius:8px; }
.testimonios-component .form-control:focus{ border-color:#667eea; box-shadow:0 0 0 3px rgba(102,126,234,.12); }

/* Responsive: un toque más grande en pantallas XL */
@media (min-width:1200px){
  .testimonios-component .table{ font-size:1rem; }
  .testimonios-component .table thead th{ font-size:.9rem; }
}
</style>



<div class="testimonios-component">
  <div class="card">
    <div class="card-header d-flex justify-content-between align-items-center">
      <h6 class="mb-0"><i class="fa fa-comments mr-2"></i>Gestión de Testimonios</h6>
      <div class="toolbar d-flex align-items-center">
        <input id="buscarTestimonio" class="form-control mr-2" placeholder="Buscar por nombre o empresa...">
        <button class="btn btn-success btn-sm mr-2" onclick="cargarTestimonios && cargarTestimonios()">
          <i class="fa fa-refresh"></i> Recargar
        </button>
        <button class="btn btn-primary btn-sm" data-toggle="modal" data-target="#modalTestimonio" onclick="limpiarFormTestimonio && limpiarFormTestimonio()">
          <i class="fa fa-plus"></i> Nuevo
        </button>
      </div>
    </div>

    <div class="card-body p-2">
      <div class="table-responsive">
        <table class="table">
          <thead>
            <tr>
              <th>Foto</th>
              <th>Nombre</th>
              <th>Empresa</th>
              <th>Testimonio</th>
              <th>Estado</th>
              <th>Fecha</th>
              <th class="text-right">Acciones</th>
            </tr>
          </thead>
          <tbody id="tablaTestimonios">
            <!-- filas dinámicas -->
            <tr>
              <td colspan="7" class="text-center text-muted">
                <div class="spinner-border" role="status"><span class="sr-only">Cargando...</span></div>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>

<!-- Modal para Agregar/Editar Testimonio -->
<div class="modal fade" id="modalTestimonio" tabindex="-1" role="dialog" aria-labelledby="modalTestimonioLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="modalTestimonioLabel">
          <i class="fa fa-comment"></i>
          <span id="modalTitle">Agregar Testimonio</span>
        </h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Cerrar">
          <span>&times;</span>
        </button>
      </div>
      <form id="formTestimonio">
        <div class="modal-body">
          <input type="hidden" id="testimonioId">
          
          <div class="row">
            <div class="col-md-6">
              <div class="form-group">
                <label for="testimonioNombre">
                  <i class="fa fa-user"></i>Nombre *
                </label>
                <input type="text" class="form-control" id="testimonioNombre" required maxlength="100"
                       placeholder="Ej: Juan Pérez">
              </div>
            </div>
            <div class="col-md-6">
              <div class="form-group">
                <label for="testimonioEmpresa">
                  <i class="fa fa-building"></i>Empresa *
                </label>
                <input type="text" class="form-control" id="testimonioEmpresa" required maxlength="100"
                       placeholder="Ej: Constructora ABC">
              </div>
            </div>
          </div>

          <div class="form-group">
            <label for="testimonioTexto">
              <i class="fa fa-quote-left"></i>Testimonio *
            </label>
            <textarea class="form-control" id="testimonioTexto" rows="4" required maxlength="500" 
                      placeholder="Escribe el testimonio del cliente..."></textarea>
            <small class="form-text">
              <i class="fa fa-info-circle"></i>
              <span id="contadorCaracteres">0</span>/500 caracteres
            </small>
          </div>

          <div class="row">
            <div class="col-md-6">
              <div class="form-group">
                <label for="testimonioImagen">
                  <i class="fa fa-image"></i>Imagen
                </label>
                <input type="text" class="form-control" id="testimonioImagen" 
                       placeholder="img/clients/client-1.png" value="img/clients/client-1.png">
                <small class="form-text">
                  <i class="fa fa-camera"></i> Ruta de la imagen del cliente
                </small>
              </div>
            </div>
            <div class="col-md-3">
              <div class="form-group">
                <label for="testimonioOrden">
                  <i class="fa fa-sort-numeric-asc"></i>Orden
                </label>
                <input type="number" class="form-control" id="testimonioOrden" min="1" max="100"
                       placeholder="1">
              </div>
            </div>
            <div class="col-md-3">
              <div class="form-group">
                <label>
                  <i class="fa fa-toggle-on"></i>Estado
                </label>
                <div class="form-check">
                  <input class="form-check-input" type="checkbox" id="testimonioActivo" checked>
                  <label class="form-check-label" for="testimonioActivo">
                    ✅ Activo
                  </label>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-dismiss="modal">
            <i class="fa fa-times mr-1"></i>Cancelar
          </button>
          <button type="submit" class="btn btn-primary">
            <i class="fa fa-save mr-1"></i><span id="btnGuardarTexto">Guardar Testimonio</span>
          </button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- Modal de confirmación para eliminar testimonio -->
<div class="modal fade" id="deleteTestimonioConfirmModal" tabindex="-1" role="dialog" aria-labelledby="deleteTestimonioConfirmModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">
            <div class="modal-header bg-danger text-white">
                <h5 class="modal-title" id="deleteTestimonioConfirmModalLabel">
                    <i class="fa fa-exclamation-triangle mr-2"></i>
                    Confirmar eliminación
                </h5>
                <button type="button" class="close text-white" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <div class="text-center">
                    <div class="mb-3">
                        <i class="fa fa-trash-o" style="font-size: 48px; color: #dc3545;"></i>
                    </div>
                    <h5 class="mb-3" id="deleteTestimonioMessage">¿Estás seguro de eliminar este testimonio?</h5>
                    <p class="text-muted mb-0">Esta acción no se puede deshacer. El testimonio será eliminado permanentemente del sistema.</p>
                </div>
            </div>
            <div class="modal-footer justify-content-center">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">
                    <i class="fa fa-times mr-1"></i> Cancelar
                </button>
                <button type="button" class="btn btn-danger ml-2" id="confirmDeleteTestimonioBtn">
                    <i class="fa fa-trash-o mr-1"></i> Sí, eliminar
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Estilos específicos para testimonios -->
<style>
.table td {
  vertical-align: middle;
}

.testimonio-texto {
  max-width: 200px;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}

.testimonio-imagen {
  width: 40px;
  height: 40px;
  object-fit: cover;
  border-radius: 50%;
}

.badge-activo {
  background-color: #28a745;
}

.badge-inactivo {
  background-color: #6c757d;
}

.btn-group-sm .btn {
  padding: 0.25rem 0.5rem;
  font-size: 0.875rem;
}

#contadorCaracteres {
  font-weight: bold;
}

.form-text.text-muted {
  font-size: 0.8rem;
}
</style>

<script>
/* Búsqueda rápida como en Promociones */
document.getElementById('buscarTestimonio')?.addEventListener('input', function(){
  const q = this.value.trim().toLowerCase();
  [...document.querySelectorAll('#tablaTestimonios tr[data-row="t"]')].forEach(tr=>{
    const nombre  = tr.getAttribute('data-nombre')?.toLowerCase()  || '';
    const empresa = tr.getAttribute('data-empresa')?.toLowerCase() || '';
    tr.style.display = (nombre.includes(q) || empresa.includes(q)) ? '' : 'none';
  });
});

/* Helper para renderizar cada fila con mismos botones outline que Promociones */
function renderTestimonioRow(t){
  const estado = t.activo
    ? '<span class="badge estado-activo">Activo</span>'
    : '<span class="badge estado-inactivo">Inactivo</span>';

  const fecha = t.fecha_creacion
    ? new Date(t.fecha_creacion).toLocaleDateString('es-AR')
    : '-';

  const img = t.imagen ? `<img class="avatar" src="${t.imagen}" alt="" onerror="this.src=''; this.outerHTML='<span class=&quot;text-muted&quot;>—</span>';">` : '—';

  return `
    <tr data-row="t" data-nombre="${t.nombre||''}" data-empresa="${t.empresa||''}">
      <td>${img}</td>
      <td>${t.nombre || '-'}</td>
      <td>${t.empresa || '-'}</td>
      <td class="testimonio-texto" title="${(t.texto||'').replace(/"/g,'&quot;')}">${t.texto || '-'}</td>
      <td>${estado}</td>
      <td>${fecha}</td>
      <td class="text-right acciones">
        <div class="btn-group">
          <button type="button" class="btn btn-sm btn-outline-primary" onclick="editarTestimonio(${t.id})"><i class="fa fa-edit"></i> Editar</button>
          <button type="button" class="btn btn-sm btn-outline-danger"  onclick="eliminarTestimonio(${t.id})"><i class="fa fa-trash"></i> Eliminar</button>
        </div>
      </td>
    </tr>`;
}

/* Si ya tenés una función cargarTestimonios(), solo usá renderTestimonioRow para construir las filas:
   tbody.innerHTML = data.map(renderTestimonioRow).join('') || '<tr>...</tr>';
*/
</script>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-dismiss="modal">
            <i class="fa fa-times mr-1"></i>Cancelar
          </button>
          <button type="submit" class="btn btn-primary">
            <i class="fa fa-save mr-1"></i><span id="btnGuardarTexto">Guardar Testimonio</span>
          </button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- Modal de confirmación para eliminar testimonio -->
<div class="modal fade" id="deleteTestimonioConfirmModal" tabindex="-1" role="dialog" aria-labelledby="deleteTestimonioConfirmModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">
            <div class="modal-header bg-danger text-white">
                <h5 class="modal-title" id="deleteTestimonioConfirmModalLabel">
                    <i class="fa fa-exclamation-triangle mr-2"></i>
                    Confirmar eliminación
                </h5>
                <button type="button" class="close text-white" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <div class="text-center">
                    <div class="mb-3">
                        <i class="fa fa-trash-o" style="font-size: 48px; color: #dc3545;"></i>
                    </div>
                    <h5 class="mb-3" id="deleteTestimonioMessage">¿Estás seguro de eliminar este testimonio?</h5>
                    <p class="text-muted mb-0">Esta acción no se puede deshacer. El testimonio será eliminado permanentemente del sistema.</p>
                </div>
            </div>
            <div class="modal-footer justify-content-center">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">
                    <i class="fa fa-times mr-1"></i> Cancelar
                </button>
                <button type="button" class="btn btn-danger ml-2" id="confirmDeleteTestimonioBtn">
                    <i class="fa fa-trash-o mr-1"></i> Sí, eliminar
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Estilos específicos para testimonios -->
<style>
.table td {
  vertical-align: middle;
}

.testimonio-texto {
  max-width: 200px;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}

.testimonio-imagen {
  width: 40px;
  height: 40px;
  object-fit: cover;
  border-radius: 50%;
}

.badge-activo {
  background-color: #28a745;
}

.badge-inactivo {
  background-color: #6c757d;
}

.btn-group-sm .btn {
  padding: 0.25rem 0.5rem;
  font-size: 0.875rem;
}

#contadorCaracteres {
  font-weight: bold;
}

.form-text.text-muted {
  font-size: 0.8rem;
}
</style>
